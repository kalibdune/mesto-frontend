(()=>{"use strict";var e,t={baseUrl:"https://nomoreparties.co/v1/frontend-st-cohort-201",headers:{authorization:"d470e4e0-7e0b-4ca0-a070-d367ecf5064e","Content-Type":"application/json"}},n=function(){return fetch("".concat(t.baseUrl,"/users/me"),{headers:t.headers})};function r(e){e.classList.remove("popup_is-opened"),document.removeEventListener("keydown",(function(t){return u(t,e)}))}function o(e,t){e.addEventListener("click",(function(){r(t)}))}function c(e){e.addEventListener("click",(function(t){t.target===e&&r(e)}))}function u(e,t){"Escape"===e.key&&r(t)}function a(e){e.classList.add("popup_is-opened"),document.addEventListener("keydown",(function(t){return u(t,e)}))}function i(e){e.classList.toggle("card__like-button_is-active"),e.classList.contains("card__like-button_is-active")?e.closest(".card").querySelector(".card__like-count").textContent=Number(e.closest(".card").querySelector(".card__like-count").textContent)+1:e.closest(".card").querySelector(".card__like-count").textContent=Number(e.closest(".card").querySelector(".card__like-count").textContent)-1}function s(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=t.querySelector("button");e.addEventListener("input",(function(){var t=0===e.value.length,o=!!n&&e.value.length>=n,c=!e.validity.valid;t||o||c?(e.classList.add("invalid"),r.setAttribute("disabled",!0)):(e.classList.remove("invalid"),r.removeAttribute("disabled"))}))}n().then((function(e){return e.json()})).then((function(t){e=t._id}));var l,d,_,p,f=document.querySelector(".profile__edit-button"),y=document.querySelector(".profile__add-button"),v=document.querySelector(".places__list"),m=document.querySelector(".profile__image"),b=document.querySelector(".popup_type_edit"),h=document.querySelector(".popup_type_new-card"),S=document.querySelector(".popup_type_image"),q=document.querySelector(".popup_type_avatar"),k=function(){fetch("".concat(t.baseUrl,"/cards"),{headers:t.headers}).then((function(e){return e.json()})).then((function(t){t.forEach((function(t){v.append(function(t){var n=document.querySelector("#card-template").content.cloneNode(!0);n.querySelector(".places__item").setAttribute("id",t._id);var r=n.querySelector(".card__image"),o=n.querySelector(".card__title"),c=n.querySelector(".card__like-button"),u=n.querySelector(".card__like-count");return r.setAttribute("src",t.link),r.setAttribute("alt",t.name),t.likes.find((function(t){return t._id===e}))&&c.classList.add("card__like-button_is-active"),e===t.owner._id&&r.insertAdjacentHTML("afterend",'<button type="button" class="card__delete-button"></button>'),o.textContent=t.name,u.textContent=t.likes.length,n}(t))}))}))};k(),l=document.querySelector(".profile__title"),d=document.querySelector(".profile__description"),_=document.querySelector(".profile__image"),(p=document.createElement("img")).alt="avatar image",p.style.width="120px",p.style.height="120px",_.append(p),n().then((function(e){return e.json()})).then((function(e){l.textContent=e.name,d.textContent=e.about,p.setAttribute("src",e.avatar)})),m.addEventListener("click",(function(){a(q);var e=q.querySelector(".popup__close"),u=q.querySelector("form"),i=u.querySelector("button"),l=q.querySelector(".popup__input_type_url");s(l,u),c(q),o(e,q),u.addEventListener("submit",(function e(o){o.preventDefault();var c=l.value;i.textContent="Сохраняем...",i.disabled=!0,function(e){return fetch("".concat(t.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:t.headers,body:JSON.stringify({avatar:e})})}(c).then((function(){var e;e=document.querySelector(".profile__image").querySelector("img"),n().then((function(e){return e.json()})).then((function(t){e.setAttribute("src",t.avatar)}))})).finally((function(){i.textContent="Сохранить",i.disabled=!1,r(q)})),u.removeEventListener("submit",e)}))})),f.addEventListener("click",(function(){a(b);var e=b.querySelector(".popup__close"),n=b.querySelector("form"),u=n.querySelector("button"),i=b.querySelector(".popup__input_type_name"),l=b.querySelector(".popup__input_type_description"),d=document.querySelector(".profile__title"),_=document.querySelector(".profile__description");i.value=d.textContent,l.value=_.textContent,s(i,n,40),s(l,n,200),c(b),o(e,b),n.addEventListener("submit",(function(e){e.preventDefault(),u.textContent="Сохраняем...",u.disabled=!0,function(e,n){return fetch("".concat(t.baseUrl,"/users/me"),{method:"PATCH",headers:t.headers,body:JSON.stringify({name:e,about:n})})}(i.value,l.value).then((function(){d.textContent=i.value,_.textContent=l.value})).finally((function(){r(b),u.textContent="Сохранить",u.disabled=!1}))}))})),y.addEventListener("click",(function(){a(h);var e=h.querySelector(".popup__close"),n=h.querySelector("form"),u=n.querySelector("button"),i=h.querySelector(".popup__input_type_card-name"),l=h.querySelector(".popup__input_type_url");s(i,n),s(l,n),c(h),o(e,h),n.addEventListener("submit",(function e(o){o.preventDefault();var c=i.value,a=l.value;u.textContent="Сохраняем...",u.disabled=!0,function(e,n){return fetch("".concat(t.baseUrl,"/cards"),{method:"POST",headers:t.headers,body:JSON.stringify({name:e,link:n})})}(c,a).then((function(){v.innerHTML="",k()})).finally((function(){r(h),u.textContent="Сохранить",u.disabled=!1})),n.removeEventListener("submit",e)}))})),v.addEventListener("click",(function(e){var n,r=e.target,u=r.classList;switch(!0){case u.contains("card__like-button"):var s=r.closest(".card").getAttribute("id");r.classList.contains("card__like-button_is-active")?(n=s,fetch("".concat(t.baseUrl,"/cards/likes/").concat(n),{method:"DELETE",headers:t.headers})).then((function(){return i(r)})):function(e){return fetch("".concat(t.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:t.headers})}(s).then((function(){return i(r)}));break;case u.contains("card__delete-button"):(function(e){return fetch("".concat(t.baseUrl,"/cards/").concat(e),{method:"DELETE",headers:t.headers})})(r.parentNode.getAttribute("id")).then((function(){r.parentNode.remove()}));break;case u.contains("card__image"):!function(e,t){a(t);var n=t.querySelector(".popup__close"),r=t.querySelector("img");r.setAttribute("src",e.getAttribute("src")),r.setAttribute("alt",e.getAttribute("alt")),c(t),o(n,t)}(r,S)}}))})();